<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE niftoolsxml>
<niftoolsxml version="0.7.1.0">

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

    <compound name="BKHDSection">
        <add name="length" type="uint" >length of following data</add>
        <add name="version" type="uint" ></add>
        <add name="IdA" type="uint" ></add>
        <add name="IdB" type="uint" ></add>
        <add name="constantA" type="uint" ></add>
        <add name="constantB" type="uint" ></add>
        <add name="unk" type="uint" ></add>
        <add name="zeroes" type="ubyte" cond="length #GTE# 24" arr1="length - 24">sometimes present</add>
    </compound>

    <compound name="DataPointer">
        <add name="wem id" type="uint"/>
        <add name="data section offset" type="uint" >offset into data section</add>
        <add name="wem filesize" type="uint" >length of the wem file</add>
    </compound>

    <compound name="DIDXSection">
        <add name="length" type="uint" >length of following data</add>
        <add name="data pointers" type="DataPointer" arr1="length/12"/>
    </compound>

    <compound name="DATASection">
        <add name="length" type="uint" >length of following data</add>
        <add name="wem datas" type="byte" arr1="length">binary data of the wem files</add>
    </compound>

    <enum name="HircType" numbytes="1" storage="ubyte" default="0">
		<option value="0" name="NONE" />
		<option value="1" name="Settings" />
		<option value="2" name="Sound" />
		<option value="3" name="EventAction" />
		<option value="4" name="Event" />
		<option value="5" name="RanSeqContainer" />
		<option value="6" name="SwitchContainer" />
		<option value="7" name="ActorMixer" />
		<option value="8" name="AudioBus" />
		<option value="9" name="BlendContainer" />
		<option value="10" name="MusicSegment" />
		<option value="11" name="MusicTrack" />
		<option value="12" name="MusicSwitchContainer" />
		<option value="13" name="MusicPlaylistContainer" />
		<option value="14" name="Attenuation" />
		<option value="15" name="DialogueEvent" />
		<option value="16" name="MotionBus" />
		<option value="17" name="MotionFx" />
		<option value="18" name="Effect" />
		<option value="19" name="EffectCustom" />
		<option value="20" name="AuxiliaryBus" />
		<option value="21" name="LFO" />
		<option value="22" name="Envelope" />
		<option value="23" name="AudioDevice" />
    </enum>

    <enum name="AKBKSourceType" numbytes="1" storage="ubyte" default="0">
		<option value="0" name="Data" />
		<option value="1" name="PrefetchStream" />
		<option value="2" name="Stream" />
    </enum>

    <enum name="AkPropID" numbytes="1" storage="ubyte" default="0"><option value="0" name="Volume" />
        <option value="1" name="LFE" />
        <option value="2" name="Pitch" />
        <option value="3" name="LPF" />
        <option value="4" name="HPF" />
        <option value="5" name="BusVolume" />
        <option value="6" name="MakeUpGain" />
        <option value="7" name="Priority" />
        <option value="8" name="PriorityDistanceOffset" />
        <option value="11" name="MuteRatio" />
        <option value="12" name="PAN_LR" />
        <option value="13" name="PAN_FR" />
        <option value="14" name="CenterPCT" />
        <option value="15" name="DelayTime" />
        <option value="16" name="TransitionTime" />
        <option value="17" name="Probability" />
        <option value="18" name="DialogueMode" />
        <option value="19" name="UserAuxSendVolume0" />
        <option value="20" name="UserAuxSendVolume1" />
        <option value="21" name="UserAuxSendVolume2" />
        <option value="22" name="UserAuxSendVolume3" />
        <option value="23" name="GameAuxSendVolume" />
        <option value="24" name="OutputBusVolume" />
        <option value="25" name="OutputBusHPF" />
        <option value="26" name="OutputBusLPF" />
        <option value="27" name="HDRBusThreshold" />
        <option value="28" name="HDRBusRatio" />
        <option value="29" name="HDRBusReleaseTime" />
        <option value="30" name="HDRBusGameParam" />
        <option value="31" name="HDRBusGameParamMin" />
        <option value="32" name="HDRBusGameParamMax" />
        <option value="33" name="HDRActiveRange" />
        <option value="34" name="LoopStart" />
        <option value="35" name="LoopEnd" />
        <option value="36" name="TrimInTime" />
        <option value="37" name="TrimOutTime" />
        <option value="38" name="FadeInTime" />
        <option value="39" name="FadeOutTime" />
        <option value="40" name="FadeInCurve" />
        <option value="41" name="FadeOutCurve" />
        <option value="42" name="LoopCrossfadeDuration" />
        <option value="43" name="CrossfadeUpCurve" />
        <option value="44" name="CrossfadeDownCurve" />
        <option value="45" name="MidiTrackingRootNote" />
        <option value="46" name="MidiPlayOnNoteType" />
        <option value="47" name="MidiTransposition" />
        <option value="48" name="MidiVelocityOffset" />
        <option value="49" name="MidiKeyRangeMin" />
        <option value="50" name="MidiKeyRangeMax" />
        <option value="51" name="MidiVelocityRangeMin" />
        <option value="52" name="MidiVelocityRangeMax" />
        <option value="53" name="MidiChannelMask" />
        <option value="54" name="PlaybackSpeed" />
        <option value="55" name="MidiTempoSource" />
        <option value="56" name="MidiTargetNode" />
        <option value="57" name="AttachedPluginFXID" />
        <option value="58" name="Loop" />
        <option value="59" name="InitialDelay" />
        <option value="60" name="UserAuxSendLPF0" />
        <option value="61" name="UserAuxSendLPF1" />
        <option value="62" name="UserAuxSendLPF2" />
        <option value="63" name="UserAuxSendLPF3" />
        <option value="64" name="UserAuxSendHPF0" />
        <option value="65" name="UserAuxSendHPF1" />
        <option value="66" name="UserAuxSendHPF2" />
        <option value="67" name="UserAuxSendHPF3" />
        <option value="68" name="GameAuxSendLPF" />
        <option value="69" name="GameAuxSendHPF" />
        <option value="70" name="AttenuationID" />
        <option value="71" name="PositioningTypeBlend" />
        <option value="72" name="ReflectionBusVolume" />
        <option value="73" name="PAN_UD" />
    </enum>

    <enum name="ActionScope" numbytes="1" storage="ubyte" default="0">
		<option value="1" name="GameObjectSwitch" />
		<option value="2" name="Global" />
		<option value="3" name="GameObjectId" />
		<option value="4" name="GameObjectState" />
		<option value="5" name="All" />
		<option value="9" name="AllExceptId" />
    </enum>

    <enum name="ActionType" numbytes="1" storage="ubyte" default="0">
        <option value="0x00" name="None" />
        <option value="0x12" name="SetState" />
        <option value="0x1A" name="BypassFX" />
        <option value="0x1B" name="ResetBypassFX" />
        <option value="0x19" name="SetSwitch" />
        <option value="0x10" name="UseState" />
        <option value="0x11" name="UnuseState" />
        <option value="0x04" name="Play" />
        <option value="0x05" name="PlayAndContinue" />
        <option value="0x01" name="Stop" />
        <option value="0x02" name="Pause" />
        <option value="0x03" name="Resume" />
        <option value="0x1C" name="Break" />
        <option value="0x06" name="Mute" />
        <option value="0x07" name="Unmute" />
        <option value="0x0A" name="SetVolume" />
        <option value="0x0B" name="ResetVolume" />
        <option value="0x08" name="SetPitch" />
        <option value="0x09" name="ResetPitch" />
        <option value="0x0E" name="SetLPF" />
        <option value="0x0F" name="ResetLPF" />
        <option value="0x20" name="SetHPF" />
        <option value="0x30" name="ResetHPF" />
        <option value="0x0C" name="SetBusVolume" />
        <option value="0x0D" name="ResetBusVolume" />
        <option value="0x21" name="PlayEvent" />
        <option value="0x15" name="StopEvent" />
        <option value="0x16" name="PauseEvent" />
        <option value="0x17" name="ResumeEvent" />
        <option value="0x18" name="Duck" />
        <option value="0x1D" name="Trigger" />
        <option value="0x1E" name="Seek" />
        <option value="0x22" name="ResetPlaylist" />
        <option value="0x13" name="SetGameParameter" />
        <option value="0x14" name="ResetGameParameter" />
        <option value="0x1F" name="Release" />
        <option value="0x23" name="PlayEventUnknown_O" />
        <option value="0x31" name="SetFX" />
        <option value="0x32" name="ResetSetFX" />
        <option value="0x40" name="NoOp" />
        <option value="0x33" name="SetBypassFXSlot" />
        <option value="0x34" name="ResetBypassFXSlot" />
        <option value="0x35" name="SetBypassAllFX" />
        <option value="0x36" name="ResetBypassAllFX" />
        <option value="0x37" name="ResetAllBypassFX" />
    </enum>

    <compound name="HircObject">
        <add name="id" type="uint" >id of this Sound SFX object</add>
    </compound>

    <compound name="Sound" inherit="HircObject">
        <add name="AkBankSourceData" type="AkBankSourceData"/>
        <add name="NodeBaseParams" type="NodeBaseParams"/>
    </compound>

    <compound name="Event" inherit="HircObject">
        <add name="num actions" type="ubyte"/>
        <add name="children" type="uint" arr1="num_actions"/>
    </compound>

    <compound name="CAkActionPlay" inherit="HircObject">
    </compound>

    <compound name="EventAction" inherit="HircObject">
        <add name="scope" type="ActionScope"/>
        <add name="action_type" type="ActionType"/>
        <add name="children" type="uint" arr1="1"/>
        <add name="idExt_4" type="ubyte"/>
        # instead of the stuff below?
        <add name="NodeInitialParams" type="NodeInitialParams"/>
<!--        <add name="num_params" type="ubyte"/>-->
<!--        <add name="params" type="ubyte" arr1="num_params"/>-->
<!--        <add name="num_params_types" type="ubyte"/>-->
<!--        <add name="params_types" type="uint" arr1="num_params_types"/>-->

<!--        the following is conditional on action type-->
        <add name="raw" type="byte" arr1="#ARG# - ( 11 + (NodeInitialParams\io_size))" cond="action_type != 4"/>
        <add name="byBitVector" type="ubyte" default="4" cond="action_type #EQ# 4" />
        <add name="bankID" type="uint" cond="action_type #EQ# 4" />
    </compound>

    <compound name="AkPlaylistItem">
        <add name="ulPlayID" type="uint"/>
        <add name="weight" type="uint"/>
    </compound>

    <compound name="RanSeqContainer" inherit="HircObject">
        wwiser CAkRanSeqCntr__SetInitialValues

        <add name="NodeBaseParams" type="NodeBaseParams"/>

        <add name="sLoopCount" type="ushort"/>
        <add name="sLoopModMin" type="ushort"/>
        <add name="sLoopModMax" type="ushort"/>
        <add name="fTransitionTime" type="float"/>
        <add name="fTransitionTimeModMin" type="float"/>
        <add name="fTransitionTimeModMax" type="float"/>
        <add name="wAvoidRepeatCount" type="ushort"/>
        <add name="eTransitionMode" type="ubyte"/>
        <add name="eRandomMode" type="ubyte"/>
        <add name="eMode" type="ubyte"/>
        <add name="byBitVector" type="ubyte"/>
        <add name="Num_Children" type="uint"/>
        <add name="Children" type="uint" arr1="Num_Children"/>
        <add name="num_PlayListItem" type="ushort"/>
        <add name="PlayListItem" type="AkPlaylistItem" arr1="num_PlayListItem"/>

    </compound>

    <compound name="CAkSwitchPackage">
        <add name="ulSwitchID" type="uint"/>
        <add name="ulNumItems" type="uint"/>
        <add name="nodes" type="uint" arr1="ulNumItems"/>
    </compound>

    <compound name="AkSwitchNodeParams">
        <add name="ulNodeID" type="uint"/>
        <add name="byBitVector1" type="ubyte"/>
        <add name="byBitVector2" type="ubyte"/>
        <add name="FadeOutTime" type="int"/>
        <add name="FadeInTime" type="int"/>
    </compound>

    <compound name="SwitchContainer" inherit="HircObject">

        <add name="NodeBaseParams" type="NodeBaseParams"/>

        <add name="eGroupType" type="ubyte"/>
        <add name="ulGroupID" type="uint"/>
        <add name="ulDefaultSwitch" type="uint"/>
        <add name="bIsContinuousValidation" type="ubyte"/>
        <add name="Num_Children" type="uint"/>
        <add name="Children" type="uint" arr1="Num_Children"/>
        <add name="ulNumSwitchGroups" type="uint"/>
        <add name="SwitchGroups" type="CAkSwitchPackage" arr1="ulNumSwitchGroups"/>
        <add name="ulNumSwitchParams" type="uint"/>
        <add name="SwitchNodeParams" type="AkSwitchNodeParams" arr1="ulNumSwitchParams"/>
    </compound>

    <compound name="AkMediaInformation">
        <add name="sourceID" type="uint"/>
        <add name="uInMemoryMediaSize" type="uint"/>
        <add name="uSourceBits" type="ubyte"/>
    </compound>

	<bitfield name="ulPluginID" storage="uint">
		<member width="16" pos="16" name="plugin_id" type="int"/>
		<member width="12" pos="4" name="company_id" type="int"/>
		<member width="4" pos="0" name="plugin_type" type="int"/>
	</bitfield>

    <compound name="AkBankSourceData">
        <add name="ulPluginID" type="ulPluginID"/>
        <add name="StreamType" type="AKBKSourceType"/>
        <add name="AkMediaInformation" type="AkMediaInformation"/>
        <add name="size" type="uint" cond="ulPluginID\plugin_type #EQ# 2"/>
    </compound>

    <compound name="AkTrackSrcInfo">
        <add name="trackID" type="uint"/>
        <add name="sourceID" type="uint"/>
        <add name="eventID" type="uint"/>
        <add name="fPlayAt" type="double"/>
        <add name="fBeginTrimOffset" type="double"/>
        <add name="fEndTrimOffset" type="double"/>
        <add name="fSrcDuration" type="double"/>
    </compound>

    <compound name="FXChunk">
        <add name="uFXIndex" type="byte"/>
        <add name="fxID" type="uint"/>
        <add name="bIsShareSet" type="byte"/>
        <add name="bIsRendered" type="byte" />
    </compound>

    <compound name="FXChunkBase">
        <add name="uFXIndex" type="byte"/>
        <add name="fxID" type="uint"/>
        <add name="bIsShareSet" type="byte"/>
    </compound>

    <compound name="NodeInitialFxParams">
        <add name="bIsOverrideParentFX" type="byte"/>
        <add name="uNumFx" type="byte"/>
        <add name="bitsFXBypass" type="byte" cond="uNumFx"/>
        <add name="fx" type="FXChunk" arr1="uNumFx"/>
    </compound>

    <compound name="AkPropValue">
        <add name="pID" type="AkPropID"/>
        <add name="value" type="float"/>apparently also uint, depends on pID
    </compound>

    <compound name="AkPropMinMax">
        <add name="pID" type="AkPropID"/>
        <add name="min" type="float"/>apparently also uint, depends on pID
        <add name="max" type="float"/>apparently also uint, depends on pID
    </compound>

    <compound name="NodeInitialParams">
        <add name="cProps1" type="ubyte"/>
        <add name="pProps1" type="AkPropValue" arr1="cProps1"/>
        <add name="cProps2" type="ubyte"/>
        <add name="pProps2" type="AkPropMinMax" arr1="cProps2"/>
    </compound>

    <compound name="PositioningParams">
        <add name="uBitsPositioning" type="ubyte"/>
    </compound>

	<bitfield name="AuxBitfield" storage="ubyte">
		<member width="1" pos="2" name="bOverrideUserAuxSends" type="int"/>
		<member width="1" pos="3" name="bHasAux" type="int"/>
		<member width="1" pos="4" name="bOverrideReflectionsAuxBus" type="int"/>
	</bitfield>

    <compound name="AuxParams">
        <add name="byBitVector" type="AuxBitfield"/>
        <add name="aux" type="uint" arr1="4" cond="byBitVector\bHasAux"/>
        <add name="reflectionsAuxBus" type="uint"/>
    </compound>

    <compound name="AdvSettingsParams">
        <add name="byBitVector" type="ubyte"/>
        <add name="eVirtualQueueBehavior" type="ubyte"/>
        <add name="u16MaxNumInstance" type="ushort"/>
        <add name="eBelowThresholdBehavior" type="ubyte"/>
        <add name="byBitVector" type="ubyte"/>
    </compound>

    <compound name="AkStatePropertyInfo">
<!--        todo varint-->
        <add name="PropertyId" type="ubyte"/>
        <add name="accumType" type="ubyte" />
        <add name="inDb" type="ubyte" />
    </compound>

    <compound name="AkState">
        <add name="ulStateID" type="uint"/>
        <add name="ulStateInstanceID" type="uint"/>
    </compound>

    <compound name="AkStateGroupChunk">
        <add name="ulStateGroupID" type="uint"/>
        <add name="eStateSyncType" type="ubyte" />
<!--        todo varint-->
        <add name="ulNumStates" type="ubyte" />
        <add name="states" type="AkState" arr1="ulNumStates"/>
    </compound>


    <compound name="StateChunk">
<!--        todo varint-->
        <add name="ulNumStateProps" type="ubyte"/>
        <add name="stateProps" type="AkStatePropertyInfo" arr1="ulNumStateProps"/>
<!--        todo varint-->
        <add name="ulNumStateGroups" type="ubyte"/>
        <add name="stateGroups" type="AkStateGroupChunk" arr1="ulNumStateGroups"/>
    </compound>

    <compound name="AkRTPCGraphPoint">
        <add name="From_v" type="float"/>
        <add name="To_v" type="float"/>
        <add name="Interp" type="uint"/>
    </compound>

    <compound name="RTPC">
        <add name="RTPCID" type="uint"/>
        <add name="rtpcType" type="ubyte"/>
        <add name="rtpcAccum" type="ubyte"/>
        <add name="ParamID" type="ubyte"/>todo varint
        <add name="rtpcCurveID" type="uint"/>
        <add name="eScaling" type="ubyte"/>
        <add name="ulSize" type="ushort"/>
        <add name="graph" type="AkRTPCGraphPoint" arr1="ulSize"/>
    </compound>

    <compound name="InitialRTPC">
        <add name="ulNumRTPC" type="ushort"/>
        <add name="pRTPCMgr" type="RTPC" arr1="ulNumRTPC"/>
    </compound>

    <compound name="NodeBaseParams">
        <add name="NodeInitialFxParams" type="NodeInitialFxParams"/>
        <add name="bIsOverrideParentMetadata" type="byte" since="140"/>
        <add name="uNumFx" type="byte" since="140"/>
        <add name="fx" type="FXChunkBase" arr1="uNumFx" since="140"/>
        <add name="bOverrideAttachmentParams" type="byte"/>
        <add name="OverrideBusId" type="uint"/>
        <add name="DirectParentID" type="uint"/>
        <add name="byBitVector" type="ubyte"/>
        <add name="NodeInitialParams" type="NodeInitialParams"/>
        <add name="PositioningParams" type="PositioningParams"/>
        <add name="AuxParams" type="AuxParams"/>
        <add name="AdvSettingsParams" type="AdvSettingsParams"/>
        <add name="StateChunk" type="StateChunk"/>
        <add name="InitialRTPC" type="InitialRTPC"/>
    </compound>

    <compound name="MusicTrack" inherit="HircObject">
        <add name="uFlags" type="ubyte"/>
        <add name="numSources" type="uint"/>
        <add name="pSource" type="AkBankSourceData" arr1="numSources"/>
        <add name="numPlaylistItem" type="uint"/>
        <add name="pPlaylist" type="AkTrackSrcInfo" arr1="numPlaylistItem"/>
        <add name="numSubTrack" type="uint"/>
        <add name="numClipAutomationItem" type="uint"/>
        # todo item struct
        <add name="pItems" type="uint" arr1="numClipAutomationItem"/>
        <add name="NodeBaseParams" type="NodeBaseParams"/>
        <add name="eTrackType" type="ubyte"/>
        <add name="iLookAheadTime" type="int"/>
        <add name="padding" type="ushort"/>apparently
    </compound>

    <compound name="TypeOther" inherit="HircObject">
        generic
        <add name="raw" type="byte" arr1="#ARG# - 4">raw bytes</add>
    </compound>

    <compound name="HircPointer">
        <add name="id" type="HircType"/>
        <add name="length" type="uint">length of the following data block</add>
        <add name="data" arg="length" type="Sound" cond="id == 2"/>
        <add name="data" arg="length" type="EventAction" cond="id == 3"/>
        <add name="data" arg="length" type="Event" cond="id == 4"/>
        <add name="data" arg="length" type="RanSeqContainer" cond="id == 5"/>
        <add name="data" arg="length" type="SwitchContainer" cond="id == 6"/>
        <add name="data" arg="length" type="MusicTrack" cond="id == 11"/>
        <add name="data" arg="length" type="TypeOther" cond="(id != 2) #AND# (id != 3) #AND# (id != 4) #AND# (id != 5) #AND# (id != 6) #AND# (id != 11)"/>
    </compound>

    <compound name="HIRCSection">
        The HIRC section contains all the Wwise objects, including the events, the containers to group sounds, and the references to the sound files.
        <add name="length" type="uint" >length of following data</add>
        <add name="count" type="uint"/>
        <add name="hirc pointers" type="HircPointer" arr1="count"/>
    </compound>
    
    <compound name="StreamInfo" >
        Describes a wem file in an s type bank stream
        <add name="offset" type="uint64"/>
        <add name="size" type="uint64"/>
        <add name="event id" type="uint">referred to by the events aux file</add>
        <add name="zero" type="uint"/>
    </compound>

    <compound name="BnkBufferData">
        Buffer data of bnk files
        <add name="size_b" type="uint64" >data size of aux of type b, can be in bnk's buffer 1, and maybe also an external aux b file</add>
        <add name="external_aux_b_count" type="uint" >1, guess</add>
        <add name="total_aux_count" type="uint" >1 for PC, 2 for PZ, JWE, 6 for ZTUAC</add>
        <add name="streams_count" type="uint" >variable</add>
        <add name="zeros" type="uint" arr1="7">0</add>
        <add name="zeros_per_buffer" type="uint64" arr1="external_aux_b_count" arr2="2">variable</add>
        <add name="streams" type="StreamInfo" arr1="streams_count" >data</add>
        <add name="name" type="ZString" >data</add>
        <add name="external_b_suffix" type="ZString" cond="external_aux_b_count">ext format subtypes</add>
        <add name="external_s_suffix" type="ZString" cond="streams_count">ext format subtypes</add>
    </compound>

    <compound name="BnkFileContainer" inherit="GenericHeader">
        custom struct
        <add name="bnk_header" type="BnkBufferData"/>
    </compound>

</niftoolsxml>
