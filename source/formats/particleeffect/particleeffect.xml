<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fileformat>
<fileformat>

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

    <struct name="nextRow1" inherit="MemStruct">
        <field name="unk" type="uint64" />
        <field name="maybe_hash" type="uint" /> <!-- used in JWE2 -->
        <field name="count" type="ushort">seems to count emitters / particle systems, influences counts for most effects</field>
        <field name="count_repeat" type="ushort" />
    </struct>

    <struct name="EffectRef" inherit="MemStruct">
        <field name="count"   type="ushort" />
        <field name="offset"   type="ushort" />
    </struct>

    <struct name="Effect" inherit="MemStruct">
    </struct>

    <struct name="Effect07" inherit="Effect">
        might map the different effects per emitter?
        144 bytes - PZ
        + 16 bytes for JWE2
        <field name="zero0" type="int64"/>
        <field name="a" type="short" />
        <field name="b" type="short" />
        <field name="ints1" type="int" arr1="22"/>
        <field name="floats" type="float" arr1="3"/>
        <field name="ints21" type="int" arr1="5"/>
        <field name="floats2" type="float" arr1="4" since="37"/>
        <field name="c" type="short" />
        <field name="d" type="short" />
        <field name="one" type="int64" />
    </struct>

    <struct name="Effect08" inherit="Effect">
        96 bytes - PZ
        <field name="floats" type="float" arr1="15"/>
        <field name="minus1" type="int"/>
        <field name="angle" type="float" arr1="3">radians; x,y often 0.0</field>
        <field name="floats2" type="float" arr1="5"/>
    </struct>

    <struct name="Effect09" inherit="Effect">
        32 bytes - PZ
        <field name="floats" type="float" arr1="8"/>
    </struct>

    <struct name="Effect10" inherit="Effect">
        48 bytes - PZ
        <field name="zero_0" type="int64" />
        <field name="u0" type="short" />
        <field name="u1" type="short" />
        <field name="zero_1" type="int" />
        <field name="index" type="int64" /> <!-- increments -->
        <field name="zero_2" type="int64" />
        <field name="count" type="int64" />
        <field name="one_f" type="float" />
        <field name="zero_3" type="int" />
    </struct>

    <struct name="Effect11" inherit="Effect">
        16 bytes - PZ
        <field name="floats" type="float" arr1="4"/>
    </struct>

    <struct name="Effect12" inherit="Effect">
        240 bytes - PZ
        <field name="zero_0" type="int64" />
        <field name="u0" type="short" />
        <field name="u1" type="short" />
        <field name="zero_1" type="int" />
        <field name="count1" type="int64" />
        <field name="zero_2" type="int64" />
        <field name="count2" type="int64" />
        <field name="zeros" type="int64" arr1="7"/>
        <field name="floats1" type="float" arr1="4"/>
        <field name="pi_rel" type="float"/>
        <field name="floats2" type="float" arr1="5"/>
        <field name="ints1" type="int" arr1="2"/>
        <field name="floats3" type="float" arr1="3"/>
        <field name="ints2" type="int" arr1="3"/>
        <field name="floats4" type="float" arr1="10"/>
        <field name="bytes" type="byte" arr1="16"/>
        <field name="float" type="float" />
        <field name="ints2" type="int" arr1="3"/>
    </struct>

    <struct name="Effect13" inherit="Effect">
        32 bytes - PZ
        <field name="floats" type="float" arr1="8"/>
    </struct>

    <struct name="Effect14" inherit="Effect">
        8 bytes - PZ
        probably indexing
        <field name="offset" type="int" />
        <field name="count" type="int" />
    </struct>

    <struct name="Effect15" inherit="Effect">
        32 bytes - PZ
        <field name="floats1" type="float" arr1="4"/>
        <field name="flags" type="byte" arr1="4"/>
        <field name="floats2" type="float" arr1="3"/>
    </struct>

    <struct name="Effect16" inherit="Effect">
        24 bytes - JWE2
        <field name="ints" type="int64" arr1="3"/>
    </struct>

    <struct name="Effect21" inherit="Effect">
        8 bytes - PZ
        <field name="a" type="float">maybe time</field>
        <field name="b" type="float">maybe value</field>
    </struct>

    <struct name="LastRow" inherit="MemStruct">
        <field name="unk07"   type="ushort" />
        <field name="unk08"   type="ushort" />
        <field name="unk09"   type="ushort" />
        <field name="unk10"   type="ushort" />
        <field name="unk11"   type="ushort" />
        <field name="unk12"   type="ushort" />
    </struct>

    <struct name="ParticleEffectRoot" inherit="MemStruct">
        <field name="unk64_1" type="uint64" />
        <field name="unk64_2" type="uint64" />
        <field name="unk64_3" type="uint64" />
        <field name="unk64_4" type="uint64" />
        <field name="unk64_5" type="uint64" />
        <field name="unk64_6" type="uint64" />

        <field name="unk32_1" type="uint" />
        <field name="unk32_2_neg" type="int" />
        <field name="unk32_3" type="uint" />
        <field name="unk32_4" type="uint" />

        <field name="a_unk32_1" type="uint" />
        <field name="a_unk32_2" type="uint" />
        <field name="a_unk32_3_1" type="uint" />
        <field name="a_unk32_4" type="uint" />

        <field name="atlasinfo_count" type="uint64" />
        <field name="name_foreach_textures" type="ArrayPointer" template="TextureData" arg="atlasinfo_count"/>

        <field name="nextRow1" type="nextRow1"/>
        <field name="effect00" type="EffectRef" template="Effect"/>
        <field name="effect01" type="EffectRef" template="Effect"/>
        <field name="effect02" type="EffectRef" template="Effect"/>
        <field name="effect03" type="EffectRef" template="Effect"/>
        <field name="effect04" type="EffectRef" template="Effect"/>
        <field name="effect05" type="EffectRef" template="Effect"/>
        <field name="effect06" type="EffectRef" template="Effect"/>
        <field name="effect07" type="EffectRef" template="Effect07"/>
        <field name="effect08" type="EffectRef" template="Effect08"/>
        <field name="effect09" type="EffectRef" template="Effect09"/>
        <field name="effect10" type="EffectRef" template="Effect10"/>
        <field name="effect11" type="EffectRef" template="Effect11"/>
        <field name="effect12" type="EffectRef" template="Effect12"/>
        <field name="effect13" type="EffectRef" template="Effect13"/>
        <field name="effect14" type="EffectRef" template="Effect14"/>
        <field name="effect15" type="EffectRef" template="Effect15"/>
        <field name="effect16" type="EffectRef" template="Effect16"/>
        <field name="effect17" type="EffectRef" template="Effect"/>
        <field name="effect18" type="EffectRef" template="Effect"/>
        <field name="effect19" type="EffectRef" template="Effect"/>
        <field name="effect20" type="EffectRef" template="Effect"/>
        <field name="effect21" type="EffectRef" template="Effect21"/>
        <field name="effect22" type="EffectRef" template="Effect"/>
        <field name="effect23" type="EffectRef" template="Effect"/>
        <field name="effect24" type="EffectRef" template="Effect"/>
        <field name="effect25" type="EffectRef" template="Effect"/>
        <field name="effect26" type="EffectRef" template="Effect"/>
        <field name="nextRow5" type="LastRow"/>
    </struct>

    <struct name="TextureInfo" inherit="MemStruct">
    </struct>

    <struct name="TextureData" inherit="MemStruct">
        <field name="dependency_name" type="Pointer">only present if textured</field>
    </struct>

</fileformat>

