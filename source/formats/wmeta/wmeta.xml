<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fileformat>
<fileformat>

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

    <struct name="WmetasbRoot" inherit="MemStruct">
        <field name="bnks" type="ArrayPointer" template="BnkMetaNew" arg="bnks_count" since="2"/>
        <field name="bnks" type="ArrayPointer" template="BnkMeta" arg="bnks_count" until="1"/>
        <field name="bnks_count" type="uint64" />
    </struct>

    <struct name="BnkMetaNew" inherit="MemStruct">
        PZ, JWE2, PC2: 32 bytes
        <field name="hash" type="uint" vercond="is_pz"/>
        <field name="padding" type="uint" default="0" optional="True" vercond="is_pz"/>
        <field name="type_name" type="Pointer" template="ZString"/>
        <field name="events" type="ArrayPointer" template="EventEntry" arg="events_count" />
        <field name="events_count" type="uint" />
        <field name="hash" type="uint" vercond="!is_pz"/>
        <field name="flag" type="uint" >0 or 1</field>
        <field name="unk2" type="uint" vercond="!is_pz"/>
    </struct>

    <struct name="BnkMeta" inherit="MemStruct">
		# JWE, PC: 112 bytes
        <field name="hash" type="uint" />
        <field name="_padding" type="uint" default="0"/>
        <field name="type_name" type="Pointer" template="ZString"/>
        <field name="bnk_name" type="Pointer" template="ZString"/>
        <field name="file_name" type="Pointer" template="ZString"/>
        <field name="events" type="ArrayPointer" template="EventEntry" arg="events_count" />
        <field name="events_count" type="uint64" />
        <field name="hashes" type="ArrayPointer" template="uint" arg="hashes_count"/>
        <field name="hashes_count" type="uint64" />
        <field name="media" type="ArrayPointer" template="MediaEntry" arg="media_count"/>
        <field name="media_count" type="uint64"/>
        <field name="unused 2" type="uint64"/>
        <field name="unused 3" type="uint64"/>
        <field name="unused 4" type="uint64"/>
        <field name="unused 5" type="uint64"/>
    </struct>

    <struct name="MediaEntry" inherit="MemStruct">
        PC, JWE1: 32 bytes
        <field name="hash" type="uint" />
        <field name="padding" type="uint" default="0" optional="True"/>
        <field name="type_name" type="Pointer" template="ZString"/>
        <field name="wav_name" type="Pointer" template="ZString"/>
        <field name="wem_name" type="Pointer" template="ZString"/>
    </struct>

    <struct name="EventEntry" inherit="MemStruct">
        PC, JWE1: 56 bytes
        PZ, JWE2: 40 bytes
        PC2: 44 bytes
        <field name="hash" type="uint" />
        <field name="padding" type="uint" default="0" optional="True">not padding on pz?!</field>
        <field name="event_name" type="Pointer" template="ZString" until="1"/>
        <field name="float" type="float" until="1" />
        <field name="flag 0" type="uint" />
        <field name="flag 1" type="uint" />
        <field name="flag 2" type="uint" />
        <field name="start_name" type="Pointer" template="ZString" until="1">used in stop events</field>
        <field name="zero 2" type="uint" default="0" optional="True" until="1"/>
        <field name="hash b" type="uint" />
        <field name="hash c" type="uint" /> <!-- fnv1 of lowercase event name -->
        <field name="zero 4" type="uint" default="0" optional="True"/>
        <field name="u2" type="uint" since="2"/>
        <field name="u1" type="uint" since="2" />
        <field name="u4" type="uint" since="2" vercond="is_PC2"/>
    </struct>

</fileformat>
