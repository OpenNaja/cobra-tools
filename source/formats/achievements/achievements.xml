<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE fileformat>
<fileformat>

	<xi:include href="../ovl_base/ovl_base.xml" xmlns:xi="http://www.w3.org/2001/XInclude" xpointer="xpointer(*/*)" />

    <struct name="AchievementsRoot" inherit="MemStruct">
        PZ: 48 bytes
        PC2: 32 bytes
        <field name="condition_vars" type="ArrayPointer" template="ConditionVarPtr" arg="condition_vars_count"/>
        <field name="condition_vars_count" type="uint64" />
        <field name="condition_checks" type="ArrayPointer" template="ConditionCheck" arg="condition_checks_count"/>
        <field name="condition_checks_count" type="uint64" />
        <field name="c" type="ArrayPointer" template="Achievement" arg="c_count" until="3"/>
        <field name="c_count" type="uint64" until="3"/>
    </struct>

    <struct name="ConditionVarPtr" inherit="MemStruct">
        <field name="condition_var" type="Pointer" template="ConditionVar"/>
    </struct>

    <struct name="ConditionRef" inherit="MemStruct">
        <field name="mode" type="uint64" />
        <field name="condition_var" type="Pointer" template="ConditionVar"/>reference to entries from condition_vars array
    </struct>

    <struct name="ConditionRef2" inherit="MemStruct">
        PZ 64, or probably 48 bytes
        <field name="ref_name" type="Pointer" template="ZString"/>
        <field name="mode" type="uint64" />
        <field name="condition_ref" type="Pointer" template="ConditionRef"/>
        <field name="count" type="uint64" default="1"/>
        <field name="zero1" type="uint64" default="0" optional="true" />
        <field name="zero2" type="uint64" default="0" optional="true" />
<!--        <field name="zero3" type="uint64" default="0" optional="true" />-->
<!--        <field name="zero4" type="uint64" default="0" optional="true" />-->
    </struct>

    <struct name="ConditionRefPtr" inherit="MemStruct">
        <field name="ptr" type="Pointer" template="ConditionRef"/>
    </struct>

    <struct name="ConditionRef2Ptr" inherit="MemStruct">
        <field name="ptr" type="Pointer" template="ConditionRef2"/>
    </struct>

    <struct name="ConditionsPtr" inherit="MemStruct">
        <field name="ptr" type="ArrayPointer" template="ConditionPtr" arg="count"/>
        <field name="count" type="uint64" />
    </struct>

    <struct name="ConditionVar" inherit="MemStruct">
        PZ 32 bytes
        <field name="Condition_name" type="Pointer" template="ZString"/>
        <field name="b" type="uint64" />
        <field name="count" type="uint64" />
        <field name="d" type="uint64" />
    </struct>

    <struct name="ConditionPc2" inherit="MemStruct">
        PC2 32 bytes
            PTR @ 352  -> SUB 117 | 7168 (  32)
      00 00 00 00 00 00 00 00 40 50 4F 49 4E 54 45 52  ........@POINTER
      00 00 40 40 00 00 00 00 00 00 00 00 00 00 00 00  ..@@............
        <field name="a" type="uint64" />
        <field name="reference" type="Pointer" /> into Conditions array
        <field name="b" type="uint64" />
        <field name="c" type="uint64" />
    </struct>

    <struct name="ConditionCheck" inherit="MemStruct">
        PZ 40 bytes
        <field name="Condition_name" type="Pointer" template="ZString"/>
        <field name="Condition_index" type="uint64" since="5"/>
        <field name="Condition_index_str" type="Pointer" template="ZString" since="5"/>
        <field name="Count" type="uint64" since="5"/>
        <field name="zero" type="Pointer" template="ConditionPc2" since="5"/>
        <field name="Conditions2" type="ArrayPointer" template="ConditionRef2Ptr" arg="Conditions2_count" until="3"/>points to array of pointers
        <field name="Conditions2_count" type="uint64" until="3"/>
        <field name="Conditions" type="ArrayPointer" template="ConditionRefPtr" arg="Conditions_count" until="3"/>
        <field name="Conditions_count" type="uint64"  until="3"/>
    </struct>

    <struct name="Achievement" inherit="MemStruct">
        PZ 64 bytes
        <field name="achievement_name" type="Pointer" template="ZString"/>
        <field name="Conditions" type="ArrayPointer" template="ConditionRefPtr" arg="Conditions_count"/>
        <field name="Conditions_count" type="int" default="1" optional="true"/>
        <field name="minus_one1" type="int" default="-1" optional="true" />
        <field name="minus_one2" type="int" default="-1" optional="true" />
        <field name="zero1" type="int" default="0" optional="true"/>
        <field name="zero2" type="uint64" default="0" optional="true" />
        <field name="flags" type="ubyte" arr1="4" />
        <field name="zero3" type="int" default="0" optional="true" />
        <field name="zero4" type="uint64" default="0" optional="true" />
        <field name="zero5" type="uint64" default="0" optional="true" />
    </struct>

</fileformat>
